# Slim 4 å°ˆæ¡ˆéœ€æ±‚æ–‡ä»¶

## å°ˆæ¡ˆæ¦‚è¿°

é€™æ˜¯ä¸€å€‹åŸºæ–¼ Slim 4 æ¡†æ¶çš„ PHP å°ˆæ¡ˆï¼Œæ—¨åœ¨æä¾›ä¸€å€‹è¼•é‡ç´šä½†åŠŸèƒ½å®Œæ•´çš„ç¶²ç«™æ¡†æ¶ï¼ŒåŒ…å«å‰å°å±•ç¤ºå’Œå¾Œå°ç®¡ç†ç³»çµ±ã€‚å°ˆæ¡ˆä½¿ç”¨ Twig æ¨¡æ¿å¼•æ“ã€PHP-DI ä¾è³´æ³¨å…¥å®¹å™¨ã€Doctrine DBAL è³‡æ–™åº«æŠ½è±¡å±¤å’Œ Dotenv ç’°å¢ƒè®Šæ•¸ç®¡ç†ã€‚

## æŠ€è¡“è¦æ ¼

### æ ¸å¿ƒæŠ€è¡“

- **PHP ç‰ˆæœ¬**ï¼šPHP 8.3+
- **æ¡†æ¶**ï¼šSlim 4
- **æ¨¡æ¿å¼•æ“**ï¼šTwig 3
- **ä¾è³´æ³¨å…¥**ï¼šPHP-DI
- **è³‡æ–™åº«æŠ½è±¡å±¤**ï¼šDoctrine DBAL
- **ç’°å¢ƒè®Šæ•¸**ï¼šDotenv
- **æ—¥èªŒç³»çµ±**ï¼šMonolog
- **å¿«å–ç³»çµ±**ï¼šRedis

### å‰ç«¯æŠ€è¡“

- **å¾Œå° UI å¥—ä»¶**ï¼šTabler
  - åŸºæ–¼ Bootstrap çš„é–‹æºå¾Œå°ä»‹é¢å¥—ä»¶
  - åŒ…å«éŸ¿æ‡‰å¼å°èˆªæ¬„ã€å´é‚Šæ¬„ã€è¡¨å–®ç­‰å…ƒä»¶
  - ä½¿ç”¨ Tabler Icons åœ–ç¤ºåº«

### é–‹ç™¼ç’°å¢ƒ

- **Docker å®¹å™¨**ï¼š
  - PHP 8.3 (php-fpm)
  - Nginx
  - MySQL 8.0
  - Redis
  - æœ¬åœ° SSL æ†‘è­‰ (mkcert)

### è³‡æ–™åº«

- **è³‡æ–™åº«å¼•æ“**ï¼šMySQL 8.0
- **å­—å…ƒç·¨ç¢¼**ï¼šutf8mb4
- **æ’åºè¦å‰‡**ï¼šutf8mb4_general_ci

## åŠŸèƒ½éœ€æ±‚

### 1. å‰å°åŠŸèƒ½

#### 1.1 åŸºæœ¬é é¢
- é¦–é  (Landing Page)
- æ–‡ç« åˆ—è¡¨é 
- æ–‡ç« è©³æƒ…é 

### 2. å¾Œå°ç®¡ç†ç³»çµ±

#### 2.1 ä½¿ç”¨è€…èªè­‰
- ç™»å…¥åŠŸèƒ½
- ç™»å‡ºåŠŸèƒ½
- Session ç®¡ç†

#### 2.2 æ¬Šé™ç®¡ç†
- **é–‹ç™¼é‡é»**ï¼š
  - ä½¿ç”¨ `RouteContext::fromRequest($request)->getRoute()` å®‰å…¨å–å¾—å·²åŒ¹é…çš„ Routeã€‚
  - è‹¥ç„¡åŒ¹é… Routeï¼Œä½¿ç”¨ URI è·¯å¾‘ `getUri()->getPath()` èˆ‡ HTTP æ–¹æ³• `getMethod()` çµ„åˆä½œç‚ºåŠŸèƒ½è­˜åˆ¥ç¬¦ï¼Œç¢ºä¿æ‰€æœ‰å¾Œå°è«‹æ±‚å‡é€²å…¥æª¢æŸ¥ã€‚
  - åœ¨ `public/index.php` åˆ©ç”¨ `$app->addRoutingMiddleware()` æœ€å…ˆåŸ·è¡Œ Routingï¼Œå†ä»¥ `$app->addErrorMiddleware()` è™•ç† 404/500ã€‚
  - `PermissionMiddleware` æ³¨å…¥æµç¨‹ï¼šRouting -> Flash -> Permission -> Twigï¼Œé¿å…è·¯ç”±å±¬æ€§ç‚º nullã€‚
  - `PermissionChecker` å‹•æ…‹ç®¡ç† `permissions_ctrl_func`ã€`permissions_matrix`ï¼Œè‡ªå‹•è¨»å†Šæ–°åŠŸèƒ½ä¸¦ä¾ç¾¤çµ„è¨­å®šå•Ÿç”¨æˆ–ç¦ç”¨ã€‚
  - ä¸­ä»‹å±¤æ—¥èªŒï¼š`error_log` è¿½è¹¤è·¯ç”±åŒ¹é…ã€è³‡æ–™åº«é€£ç·šèˆ‡æ¬Šé™æª¢æŸ¥çµæœã€‚

- åŸºæ–¼è§’è‰²çš„å­˜å–æ§åˆ¶ (RBAC)
- ä½¿ç”¨è€…ç¾¤çµ„ç®¡ç†
- åŠŸèƒ½æ¬Šé™æ§åˆ¶
- å‹•æ…‹æ¬Šé™åŠŸèƒ½ï¼š
  - ç•¶ä½¿ç”¨è€…è¨ªå•å°šæœªå®šç¾©æ¬Šé™çš„åŠŸèƒ½æ™‚ï¼Œç³»çµ±è‡ªå‹•è™•ç†
  - è‹¥ä½¿ç”¨è€…å…·æœ‰æœ€é«˜æ¬Šé™è§’è‰²ï¼Œè‡ªå‹•å»ºç«‹åŠŸèƒ½æ¬Šé™ä¸¦é–‹æ”¾æ¬Šé™
  - è‹¥ä½¿ç”¨è€…ä¸å…·æœ‰æœ€é«˜æ¬Šé™è§’è‰²ï¼Œé è¨­ç¦æ­¢è¨ªå•

#### 2.3 å„€è¡¨æ¿
- ç³»çµ±æ¦‚è¦½
- ä½¿ç”¨è€…è³‡è¨Šé¡¯ç¤º

#### 2.4 å…§å®¹ç®¡ç†
- æ–‡ç« ç®¡ç† (CRUD æ“ä½œ)

## è³‡æ–™æ¨¡å‹

### 1. æ¬Šé™ç®¡ç†ç›¸é—œè³‡æ–™è¡¨

#### 1.1 åŠŸèƒ½æ§åˆ¶è¡¨ (permissions_ctrl_func)
- åŠŸèƒ½ä»£ç¢¼
- é¡¯ç¤ºåç¨±
- æ§åˆ¶å™¨å’Œæ–¹æ³•
- åŠŸèƒ½é¡å‹ (å‰å°/å¾Œå°)

#### 1.2 è§’è‰²ç¾¤çµ„è¡¨ (permissions_groups)
- ç¾¤çµ„ä»£ç¢¼
- ç¾¤çµ„åç¨±
- å‚™è¨»èªªæ˜

#### 1.3 æ¬Šé™è¨­å®šè¡¨ (permissions_matrix)
- ç¾¤çµ„èˆ‡åŠŸèƒ½çš„é—œè¯
- æ¬Šé™å•Ÿç”¨ç‹€æ…‹

#### 1.4 å¾Œå°ä½¿ç”¨è€…è¡¨ (admin_users)
- ä½¿ç”¨è€…åç¨±
- å¯†ç¢¼ (bcrypt é›œæ¹Š)
- é¡¯ç¤ºåç¨±
- æ‰€å±¬ç¾¤çµ„
- ç™»å…¥è¨˜éŒ„

### 2. å…§å®¹ç®¡ç†ç›¸é—œè³‡æ–™è¡¨

#### 2.1 æ–‡ç« è¡¨ (posts)
- æ¨™é¡Œ
- å…§å®¹
- å»ºç«‹æ™‚é–“

## ç³»çµ±æ¶æ§‹

### 1. ç›®éŒ„çµæ§‹
```
app/
  Actions/      â†’ æ§åˆ¶å™¨é¡åˆ¥ï¼Œè™•ç† HTTP è«‹æ±‚
    BaseAction.php      â†’ åŸºç¤æ§åˆ¶å™¨é¡åˆ¥
    HomeAction.php      â†’ é¦–é æ§åˆ¶å™¨
    PostDemoAction.php  â†’ æ–‡ç« ç¤ºç¯„æ§åˆ¶å™¨
    Opanel/             â†’ å¾Œå°ç®¡ç†ç›¸é—œæ§åˆ¶å™¨
  Models/       â†’ è³‡æ–™æ¨¡å‹é¡åˆ¥
    PostModel.php       â†’ æ–‡ç« æ¨¡å‹
  Routes/       â†’ è·¯ç”±å®šç¾©æª”æ¡ˆ
    home.php            â†’ é¦–é è·¯ç”±
    posts.php           â†’ æ–‡ç« è·¯ç”±
    opanel_auth.php     â†’ å¾Œå°èªè­‰è·¯ç”±
    opanel_dashboard.php â†’ å¾Œå°å„€è¡¨æ¿è·¯ç”±
  Templates/    â†’ Twig æ¨¡æ¿æª”æ¡ˆ
    hello.twig          â†’ æ­¡è¿é æ¨¡æ¿
    landing.twig        â†’ é¦–é æ¨¡æ¿
    posts.twig          â†’ æ–‡ç« åˆ—è¡¨æ¨¡æ¿
    opanel/             â†’ å¾Œå°æ¨¡æ¿ç›®éŒ„
  database.php  â†’ è³‡æ–™åº«é€£ç·šè¨­å®š (Doctrine DBAL)
  dependencies.php â†’ å®¹å™¨ä¾è³´è¨­å®š
  middleware.php â†’ å…¨åŸŸä¸­ä»‹ä»¶
  routes.php    â†’ è·¯ç”±å®šç¾©å…¥å£é»
  settings.php  â†’ æ‡‰ç”¨ç¨‹å¼è¨­å®š

cache/
  twig/         â†’ Twig æ¨¡æ¿å¿«å–

docs/
  sql/          â†’ SQL è³‡æ–™åº«çµæ§‹æª”æ¡ˆ
    auth_table.sql      â†’ æ¬Šé™ç®¡ç†ç›¸é—œè³‡æ–™è¡¨
    post.sql            â†’ æ–‡ç« è³‡æ–™è¡¨

docker/         â†’ Docker ç›¸é—œé…ç½®
  mysql/        â†’ MySQL é…ç½®
  nginx/        â†’ Nginx é…ç½®
  php/          â†’ PHP é…ç½®
  phpmyadmin/    â†’ PHPMyAdmin é…ç½®
  ssl/          â†’ SSL æ†‘è­‰

log/
  app.log       â†’ æ‡‰ç”¨ç¨‹å¼æ—¥èªŒ

public/
  index.php     â†’ æ‡‰ç”¨ç¨‹å¼å…¥å£é»
  assets/        â†’ å‰ç«¯è³‡æºæª”æ¡ˆ
    tabler/      â†’ Tabler UI å¥—ä»¶
  .htaccess     â†’ Apache é‡å¯«è¦å‰‡
```

### 2. è¨­è¨ˆæ¨¡å¼
- MVC æ¶æ§‹
- ä¾è³´æ³¨å…¥æ¨¡å¼
- è³‡æºåº«æ¨¡å¼ (Repository Pattern)

## éåŠŸèƒ½éœ€æ±‚

### 1. æ•ˆèƒ½
- ä½¿ç”¨ Redis é€²è¡Œå¿«å–
- å„ªåŒ–è³‡æ–™åº«æŸ¥è©¢
- Twig æ¨¡æ¿å¿«å–

### 2. å®‰å…¨æ€§
- å¯†ç¢¼ä½¿ç”¨ bcrypt é›œæ¹Š
- é˜²æ­¢ SQL æ³¨å…¥
- CSRF ä¿è­·
- XSS é˜²è­·

### 3. å¯ç¶­è­·æ€§
- æ¨¡çµ„åŒ–ä»£ç¢¼çµæ§‹
- æ¸…æ™°çš„å‘½åç´„å®š
- å®Œæ•´çš„æ–‡æª”

### 4. å¯æ“´å±•æ€§
- æ”¯æ´æ·»åŠ æ–°æ¨¡çµ„
- éˆæ´»çš„è·¯ç”±ç³»çµ±
- å¯é…ç½®çš„ä¾è³´æ³¨å…¥

## ç’°å¢ƒéœ€æ±‚

### é–‹ç™¼ç’°å¢ƒ
- Docker
- Docker Compose
- mkcert (ç”¨æ–¼ç”Ÿæˆæœ¬åœ°ä¿¡ä»»çš„ SSL æ†‘è­‰)
- æœ¬æ©Ÿ hosts æª”æ¡ˆè¨­å®šï¼š
  ```
  127.0.0.1 ndev.local
  127.0.0.1 ndba.local
  ```

### ç”Ÿç”¢ç’°å¢ƒ
- PHP 8.3+
- MySQL 8.0+
- Redis
- Nginx æˆ– Apache
- SSL æ†‘è­‰

## éƒ¨ç½²æµç¨‹

### æœ¬åœ°é–‹ç™¼
1. å®‰è£ Docker å’Œ Docker Compose
2. å®‰è£ mkcert ä¸¦è¨­å®šæœ¬åœ° CA
3. ç”Ÿæˆæœ¬åœ° SSL æ†‘è­‰
4. è¨­å®š .env æª”æ¡ˆ
5. åŸ·è¡Œ `docker compose up -d`

### ç”Ÿç”¢ç’°å¢ƒ
1. è¨­å®šä¼ºæœå™¨ç’°å¢ƒ
2. è¨­å®šè³‡æ–™åº«
3. éƒ¨ç½²ç¨‹å¼ç¢¼
4. è¨­å®š Web ä¼ºæœå™¨
5. è¨­å®š SSL æ†‘è­‰

## å¾Œå°åŠŸèƒ½é–‹ç™¼è¦åŠƒ

### ç¬¬ä¸€éšæ®µ To-Do åˆ—è¡¨

| æ¨¡çµ„ | åŠŸèƒ½å»ºè­° | å‚™è¨» |
|------|---------|------|
| âœ… ç™»å…¥/ç™»å‡º | å·²å®Œæˆ | å¯åŠ  session timeout æ©Ÿåˆ¶ |
| âœ… Dashboard | åŸºæœ¬å®Œæˆ | å¯åŠ ä¸Šç³»çµ±çµ±è¨ˆæˆ–å¿«æ·æ“ä½œå€åŸŸ |
| ğŸ”’ æ¬Šé™ç³»çµ± | å¾Œå°åŠŸèƒ½è‡ªå‹•è¨»å†Š + æ¬Šé™æ§ç®¡ | ä½ ä¹‹å‰è¨­è¨ˆå·²ç´å…¥ã€Œä½¿ç”¨æ™‚è‡ªå‹•è¨»å†Šã€ï¼Œé€²ä¸€æ­¥å®Œå–„ |
| ğŸ‘¤ ä½¿ç”¨è€…ç®¡ç† | å»ºç«‹/ä¿®æ”¹/åœç”¨å¸³è™Ÿ | ä¸€èˆ¬ CMS çš„æ ¸å¿ƒåŠŸèƒ½ |
| ğŸ”„ middleware æå– session | å¯é¸ï¼š ä¸­ä»‹å±¤æå– session->user | è®“ controller ä¸å¿…åè¦† $_SESSION[...] |


