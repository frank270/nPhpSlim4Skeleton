import{R,j as s,a as D,r as t}from"./assets/client-CnLxy5PC.js";function I(){const[l,T]=t.useState(null),[o,b]=t.useState({username:"",display_name:"",group_id:"",status:1}),[S,_]=t.useState([]),[E,w]=t.useState(!0),[d,j]=t.useState(!1),[h,f]=t.useState(""),[N,y]=t.useState(""),[u,g]=t.useState(!1);t.useEffect(()=>{const e=window.location.pathname.split("/"),a=e[e.indexOf("users")+1];T(a)},[]);const P=async()=>{var e,a;if(l){w(!0);try{const n=await(await fetch(`/opanel/users/${l}/edit`,{method:"GET",headers:{Accept:"application/json"}})).json();if(!n.user)throw new Error("使用者資料不存在");b(n.user)}catch(r){console.error("載入使用者資料失敗",r),(a=(e=window.Tabler)==null?void 0:e.Toast)==null||a.show("載入使用者資料失敗",{color:"red"})}finally{w(!1)}}},C=async()=>{var e,a;try{const n=await(await fetch("/opanel/access/roles/list")).json();_(n.roles||[])}catch(r){console.error("載入角色群組列表失敗",r),(a=(e=window.Tabler)==null?void 0:e.Toast)==null||a.show("載入角色群組列表失敗",{color:"red"})}};t.useEffect(()=>{C()},[]),t.useEffect(()=>{l&&P()},[l]);const p=e=>{const{name:a,value:r}=e.target;b({...o,[a]:r})},F=async e=>{var a,r,n,c;e.preventDefault(),j(!0);try{const m=await(await fetch(`/opanel/users/${l}/edit`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({display_name:o.display_name,group_id:o.group_id||null,status:o.status})})).json();if(!m.success)throw new Error(m.message||"更新使用者資料失敗");(r=(a=window.Tabler)==null?void 0:a.Toast)==null||r.show("使用者資料更新成功",{color:"success"})}catch(i){console.error("更新使用者資料失敗",i),(c=(n=window.Tabler)==null?void 0:n.Toast)==null||c.show(i.message||"更新使用者資料失敗",{color:"red"})}finally{j(!1)}},O=async e=>{var a,r,n,c,i,m;if(e.preventDefault(),h!==N){(r=(a=window.Tabler)==null?void 0:a.Toast)==null||r.show("兩次輸入的密碼不一致",{color:"red"});return}g(!0);try{const v=await(await fetch(`/opanel/users/${l}/reset-password`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:h})})).json();if(!v.success)throw new Error(v.message||"重設密碼失敗");(c=(n=window.Tabler)==null?void 0:n.Toast)==null||c.show("密碼重設成功",{color:"success"}),f(""),y("")}catch(x){console.error("重設密碼失敗",x),(m=(i=window.Tabler)==null?void 0:i.Toast)==null||m.show(x.message||"重設密碼失敗",{color:"red"})}finally{g(!1)}};return s.jsxs("div",{className:"container-fluid",children:[s.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[s.jsx("h1",{className:"h3",children:"編輯後台使用者"}),s.jsxs("a",{href:"/opanel/users",className:"btn btn-secondary",children:[s.jsx("i",{className:"fas fa-arrow-left"})," 返回列表"]})]}),E?s.jsx("div",{className:"text-center py-5",children:s.jsx("div",{className:"spinner-border text-primary",role:"status",children:s.jsx("span",{className:"visually-hidden",children:"載入中..."})})}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"card shadow mb-4",children:[s.jsx("div",{className:"card-header py-3",children:s.jsx("h3",{className:"m-0 font-weight-bold text-primary",children:"使用者資料"})}),s.jsx("div",{className:"card-body",children:s.jsxs("form",{onSubmit:F,children:[s.jsxs("div",{className:"mb-3",children:[s.jsx("label",{htmlFor:"username",className:"form-label",children:"帳號"}),s.jsx("input",{type:"text",className:"form-control",id:"username",value:o.username,disabled:!0,readOnly:!0}),s.jsx("small",{className:"form-text text-muted",children:"帳號不可修改"})]}),s.jsxs("div",{className:"mb-3",children:[s.jsx("label",{htmlFor:"display_name",className:"form-label",children:"顯示名稱"}),s.jsx("input",{type:"text",className:"form-control",id:"display_name",name:"display_name",value:o.display_name||"",onChange:p,disabled:d}),s.jsx("small",{className:"form-text text-muted",children:"顯示在系統中的名稱"})]}),s.jsxs("div",{className:"mb-3",children:[s.jsx("label",{htmlFor:"group_id",className:"form-label",children:"角色群組"}),s.jsxs("select",{className:"form-control",id:"group_id",name:"group_id",value:o.group_id||"",onChange:p,disabled:d,children:[s.jsx("option",{value:"",children:"-- 請選擇角色群組 --"}),S.map(e=>s.jsx("option",{value:e.id,children:e.name},e.id))]}),s.jsx("small",{className:"form-text text-muted",children:"使用者的權限將依據所屬群組設定"})]}),s.jsxs("div",{className:"mb-3",children:[s.jsx("label",{htmlFor:"status",className:"form-label",children:"狀態"}),s.jsxs("select",{className:"form-control",id:"status",name:"status",value:o.status,onChange:p,disabled:d,children:[s.jsx("option",{value:"1",children:"啟用"}),s.jsx("option",{value:"0",children:"停用"})]})]}),s.jsx("button",{type:"submit",className:"btn btn-primary",disabled:d,children:d?s.jsxs(s.Fragment,{children:[s.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"處理中..."]}):"更新使用者"})]})})]}),s.jsxs("div",{className:"card shadow mb-4",children:[s.jsx("div",{className:"card-header py-3",children:s.jsx("h6",{className:"m-0 font-weight-bold text-danger",children:"重設密碼"})}),s.jsx("div",{className:"card-body",children:s.jsxs("form",{onSubmit:O,children:[s.jsxs("div",{className:"mb-3",children:[s.jsx("label",{htmlFor:"new_password",className:"form-label",children:"新密碼"}),s.jsx("input",{type:"password",className:"form-control",id:"new_password",value:h,onChange:e=>f(e.target.value),disabled:u,required:!0})]}),s.jsxs("div",{className:"mb-3",children:[s.jsx("label",{htmlFor:"confirm_password",className:"form-label",children:"確認密碼"}),s.jsx("input",{type:"password",className:"form-control",id:"confirm_password",value:N,onChange:e=>y(e.target.value),disabled:u,required:!0})]}),s.jsx("button",{type:"submit",className:"btn btn-warning",disabled:u,children:u?s.jsxs(s.Fragment,{children:[s.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"處理中..."]}):"重設密碼"})]})})]})]})]})}R.createRoot(document.getElementById("admin-users-edit-app")).render(s.jsx(D.StrictMode,{children:s.jsx(I,{})}));
