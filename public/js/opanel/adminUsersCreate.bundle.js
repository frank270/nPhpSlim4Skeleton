import{R as S,j as e,a as C,r as o}from"./assets/client-CnLxy5PC.js";function F(){const[s,N]=o.useState({username:"",password:"",confirmPassword:"",display_name:"",group_id:""}),[y,g]=o.useState([]),[v,c]=o.useState(!1),[r,m]=o.useState(!1),T=async()=>{var a,l;c(!0);try{const d=await(await fetch("/opanel/access/roles/list")).json();g(d.roles||[])}catch(n){console.error("載入角色群組列表失敗",n),(l=(a=window.Tabler)==null?void 0:a.Toast)==null||l.show("載入角色群組列表失敗",{color:"red"})}finally{c(!1)}};o.useEffect(()=>{T()},[]);const t=a=>{const{name:l,value:n}=a.target;N({...s,[l]:n})},_=async a=>{var l,n,d,u,h,p,x,f,j,w;if(a.preventDefault(),!s.username){(n=(l=window.Tabler)==null?void 0:l.Toast)==null||n.show("請輸入帳號",{color:"red"});return}if(!s.password){(u=(d=window.Tabler)==null?void 0:d.Toast)==null||u.show("請輸入密碼",{color:"red"});return}if(s.password!==s.confirmPassword){(p=(h=window.Tabler)==null?void 0:h.Toast)==null||p.show("兩次輸入的密碼不一致",{color:"red"});return}m(!0);try{const b=await(await fetch("/opanel/users/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:s.username,password:s.password,display_name:s.display_name,group_id:s.group_id||null})})).json();if(!b.success)throw new Error(b.message||"新增使用者失敗");(f=(x=window.Tabler)==null?void 0:x.Toast)==null||f.show("使用者新增成功",{color:"success"}),window.location.href="/opanel/users"}catch(i){console.error("新增使用者失敗",i),(w=(j=window.Tabler)==null?void 0:j.Toast)==null||w.show(i.message||"新增使用者失敗",{color:"red"})}finally{m(!1)}};return e.jsxs("div",{className:"container-fluid",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[e.jsx("h1",{className:"h3",children:"新增後台使用者"}),e.jsxs("a",{href:"/opanel/users",className:"btn btn-secondary",children:[e.jsx("i",{className:"fas fa-arrow-left"})," 返回列表"]})]}),e.jsxs("div",{className:"card shadow mb-4",children:[e.jsx("div",{className:"card-header py-3",children:e.jsx("h3",{className:"m-0 font-weight-bold text-primary",children:"使用者資料"})}),e.jsx("div",{className:"card-body",children:v?e.jsx("div",{className:"text-center py-5",children:e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"載入中..."})})}):e.jsxs("form",{onSubmit:_,children:[e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{htmlFor:"username",className:"form-label",children:["帳號 ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("input",{type:"text",className:"form-control",id:"username",name:"username",value:s.username,onChange:t,disabled:r,required:!0}),e.jsx("small",{className:"form-text text-muted",children:"帳號用於登入系統，建立後不可修改"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{htmlFor:"password",className:"form-label",children:["密碼 ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("input",{type:"password",className:"form-control",id:"password",name:"password",value:s.password,onChange:t,disabled:r,required:!0}),e.jsx("small",{className:"form-text text-muted",children:"請設定安全的密碼"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{htmlFor:"confirmPassword",className:"form-label",children:["確認密碼 ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("input",{type:"password",className:"form-control",id:"confirmPassword",name:"confirmPassword",value:s.confirmPassword,onChange:t,disabled:r,required:!0}),e.jsx("small",{className:"form-text text-muted",children:"請再次輸入密碼以確認"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"display_name",className:"form-label",children:"顯示名稱"}),e.jsx("input",{type:"text",className:"form-control",id:"display_name",name:"display_name",value:s.display_name,onChange:t,disabled:r}),e.jsx("small",{className:"form-text text-muted",children:"顯示在系統中的名稱"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"group_id",className:"form-label",children:"角色群組"}),e.jsxs("select",{className:"form-control",id:"group_id",name:"group_id",value:s.group_id,onChange:t,disabled:r,children:[e.jsx("option",{value:"",children:"-- 請選擇角色群組 --"}),y.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]}),e.jsx("small",{className:"form-text text-muted",children:"使用者的權限將依據所屬群組設定"})]}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:r,children:r?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"處理中..."]}):"建立使用者"})]})})]})]})}S.createRoot(document.getElementById("admin-users-create-app")).render(e.jsx(C.StrictMode,{children:e.jsx(F,{})}));
