import{R as I,j as s,a as O,r as a}from"./assets/client-CnLxy5PC.js";function W(){const[i,c]=a.useState([]),[M,f]=a.useState(!0),[C,v]=a.useState([]),[w,P]=a.useState(""),[u,T]=a.useState(""),[L,h]=a.useState(!1),[l,R]=a.useState(null),[b,m]=a.useState(""),[N,x]=a.useState(""),[n,y]=a.useState(!1),[F,j]=a.useState(!1),[r,E]=a.useState(null),[p,k]=a.useState(!1),S=async()=>{f(!0);try{let e="/opanel/users/list";const t=new URLSearchParams;w&&t.append("group_id",w),u&&t.append("keyword",u),t.toString()&&(e+="?"+t.toString());const d=await(await fetch(e)).json();c(d.users||[])}catch(e){console.error("載入使用者列表失敗",e),window.showToast("載入使用者列表失敗","error"),c([])}finally{f(!1)}},U=async()=>{try{const t=await(await fetch("/opanel/access/roles/list")).json();v(t.roles||[])}catch(e){console.error("載入角色群組列表失敗",e),window.showToast("載入角色群組列表失敗","error"),v([])}},z=async(e,t)=>{try{const d=await(await fetch(`/opanel/users/${e}/toggle-status`,{method:"POST"})).json();if(!d.success)throw new Error(d.message||"操作失敗");c(i.map(g=>g.id===e?{...g,status:t===1?0:1}:g)),window.showToast(d.message||"狀態已更新","success")}catch(o){console.error("切換使用者狀態失敗",o),window.showToast(o.message||"切換使用者狀態失敗","error")}},B=async()=>{if(l){if(b!==N){window.showToast("兩次輸入的密碼不一致","error");return}y(!0);try{const t=await(await fetch(`/opanel/users/${l.id}/reset-password`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:b})})).json();if(!t.success)throw new Error(t.message||"重設密碼失敗");window.showToast("密碼重設成功","success"),h(!1),m(""),x("")}catch(e){console.error("重設密碼失敗",e),window.showToast(e.message||"重設密碼失敗","error")}finally{y(!1)}}},D=async()=>{if(r){k(!0);try{const t=await(await fetch(`/opanel/users/${r.id}/delete`,{method:"POST"})).json();if(!t.success)throw new Error(t.message||"刪除使用者失敗");c(i.filter(o=>o.id!==r.id)),window.showToast("使用者已刪除","success"),j(!1)}catch(e){console.error("刪除使用者失敗",e),window.showToast(e.message||"刪除使用者失敗","error")}finally{k(!1)}}};a.useEffect(()=>{U(),S()},[]);const H=()=>{S()};return s.jsxs("div",{className:"container-fluid",children:[s.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[s.jsx("h1",{className:"h2 mb-0",children:"後台使用者管理"}),s.jsxs("a",{href:"/opanel/users/create",className:"btn btn-primary",children:[s.jsx("i",{className:"ti ti-plus"})," 新增使用者"]})]}),s.jsxs("div",{className:"card shadow mb-4",children:[s.jsxs("div",{className:"card-header py-3 d-flex justify-content-between align-items-center",children:[s.jsx("h3",{className:"m-0 font-weight-bold text-primary",children:"使用者列表"}),s.jsxs("div",{className:"d-flex",children:[s.jsxs("select",{className:"form-control mr-2",value:w,onChange:e=>P(e.target.value),children:[s.jsx("option",{value:"",children:"所有角色群組"}),C.map(e=>s.jsx("option",{value:e.id,children:e.name},e.id))]}),s.jsx("input",{type:"text",className:"form-control mr-2",placeholder:"搜尋使用者...",value:u,onChange:e=>T(e.target.value)}),s.jsxs("button",{className:"btn btn-outline-primary",onClick:H,children:[s.jsx("i",{className:"ti ti-search me-1"})," 搜尋"]})]})]}),s.jsx("div",{className:"card-body",children:s.jsx("div",{className:"table-responsive",children:s.jsxs("table",{className:"table table-bordered",width:"100%",cellSpacing:"0",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:"ID"}),s.jsx("th",{children:"帳號"}),s.jsx("th",{children:"顯示名稱"}),s.jsx("th",{children:"角色群組"}),s.jsx("th",{children:"狀態"}),s.jsx("th",{children:"最後登入時間"}),s.jsx("th",{children:"操作"})]})}),s.jsx("tbody",{children:M?s.jsx("tr",{children:s.jsx("td",{colSpan:"7",className:"text-center",children:s.jsx("div",{className:"spinner-border text-primary",role:"status",children:s.jsx("span",{className:"visually-hidden",children:"載入中..."})})})}):i.length===0?s.jsx("tr",{children:s.jsx("td",{colSpan:"7",className:"text-center",children:"沒有符合條件的使用者"})}):i.map(e=>s.jsxs("tr",{children:[s.jsx("td",{children:e.id}),s.jsx("td",{children:e.username}),s.jsx("td",{children:e.display_name||"-"}),s.jsx("td",{children:e.group_name||"-"}),s.jsx("td",{children:e.status===1?s.jsx("span",{className:"badge bg-success text-white",children:"啟用"}):s.jsx("span",{className:"badge bg-danger text-white",children:"停用"})}),s.jsx("td",{children:e.last_login_at||"-"}),s.jsx("td",{children:s.jsxs("div",{className:"d-flex gap-1",children:[s.jsx("a",{href:`/opanel/users/${e.id}/edit`,className:"btn btn-sm btn-primary",title:"編輯",children:s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"icon",width:"24",height:"24",viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",children:[s.jsx("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),s.jsx("path",{d:"M7 7h-1a2 2 0 0 0 -2 2v9a2 2 0 0 0 2 2h9a2 2 0 0 0 2 -2v-1"}),s.jsx("path",{d:"M20.385 6.585a2.1 2.1 0 0 0 -2.97 -2.97l-8.415 8.385v3h3l8.385 -8.415z"}),s.jsx("path",{d:"M16 5l3 3"})]})}),s.jsx("button",{className:"btn btn-sm btn-warning",onClick:()=>{R(e),h(!0)},title:"重設密碼",children:s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"icon",width:"24",height:"24",viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",children:[s.jsx("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),s.jsx("path",{d:"M14 6l7 7l-4 4"}),s.jsx("path",{d:"M5.5 13.5l4.5 4.5"}),s.jsx("path",{d:"M5 3a2 2 0 0 0 -2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2 -2v-6"}),s.jsx("path",{d:"M12 11v-4a3 3 0 1 1 6 0v4"})]})}),s.jsx("button",{className:`btn btn-sm ${e.status===1?"btn-secondary":"btn-success"}`,onClick:()=>z(e.id,e.status),title:e.status===1?"停用":"啟用",children:e.status===1?s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"icon",width:"24",height:"24",viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",children:[s.jsx("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),s.jsx("path",{d:"M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0"}),s.jsx("path",{d:"M5.7 5.7l12.6 12.6"})]}):s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"icon",width:"24",height:"24",viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",children:[s.jsx("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),s.jsx("path",{d:"M5 12l5 5l10 -10"})]})}),s.jsx("button",{className:"btn btn-sm btn-danger",onClick:()=>{E(e),j(!0)},title:"刪除",children:s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"icon",width:"24",height:"24",viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",children:[s.jsx("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),s.jsx("path",{d:"M4 7l16 0"}),s.jsx("path",{d:"M10 11l0 6"}),s.jsx("path",{d:"M14 11l0 6"}),s.jsx("path",{d:"M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12"}),s.jsx("path",{d:"M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3"})]})})]})})]},e.id))})]})})})]}),L&&s.jsx("div",{className:"modal d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)"},children:s.jsx("div",{className:"modal-dialog",children:s.jsxs("div",{className:"modal-content",children:[s.jsxs("div",{className:"modal-header",children:[s.jsxs("h5",{className:"modal-title",children:["重設 ",l==null?void 0:l.username," 的密碼"]}),s.jsx("button",{type:"button",className:"btn-close",onClick:()=>{h(!1),m(""),x("")},disabled:n})]}),s.jsxs("div",{className:"modal-body",children:[s.jsxs("div",{className:"mb-3",children:[s.jsx("label",{htmlFor:"new-password",className:"form-label",children:"新密碼"}),s.jsx("input",{type:"password",className:"form-control",id:"new-password",value:b,onChange:e=>m(e.target.value),disabled:n})]}),s.jsxs("div",{className:"mb-3",children:[s.jsx("label",{htmlFor:"confirm-password",className:"form-label",children:"確認密碼"}),s.jsx("input",{type:"password",className:"form-control",id:"confirm-password",value:N,onChange:e=>x(e.target.value),disabled:n})]})]}),s.jsxs("div",{className:"modal-footer",children:[s.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>{h(!1),m(""),x("")},disabled:n,children:"取消"}),s.jsx("button",{type:"button",className:"btn btn-primary",onClick:B,disabled:n,children:n?s.jsxs(s.Fragment,{children:[s.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"處理中..."]}):"確認重設"})]})]})})}),F&&s.jsx("div",{className:"modal d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)"},children:s.jsx("div",{className:"modal-dialog modal-sm",children:s.jsxs("div",{className:"modal-content",children:[s.jsxs("div",{className:"modal-header",children:[s.jsx("h5",{className:"modal-title",children:"確認刪除"}),s.jsx("button",{type:"button",className:"btn-close",onClick:()=>j(!1),disabled:p})]}),s.jsxs("div",{className:"modal-body",children:[s.jsxs("p",{children:["確定要刪除使用者 ",s.jsx("strong",{children:r==null?void 0:r.username})," 嗎？"]}),s.jsx("p",{className:"text-danger",children:"此操作無法復原。"})]}),s.jsxs("div",{className:"modal-footer",children:[s.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>j(!1),disabled:p,children:"取消"}),s.jsx("button",{type:"button",className:"btn btn-danger",onClick:D,disabled:p,children:p?s.jsxs(s.Fragment,{children:[s.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"處理中..."]}):"確認刪除"})]})]})})})]})}I.createRoot(document.getElementById("admin-users-app")).render(s.jsx(O.StrictMode,{children:s.jsx(W,{})}));
